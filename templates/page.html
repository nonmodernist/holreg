{% extends "base.html" %}

{% block content %}
<article class="film-page">
    <div class="content-wrapper">
        <div class="main-content">
            <h1 class="film-title">{{ page.title }}</h1>
            
            {% if page.extra.author_byline %}
            <div class="film-byline">
                by <span class="author-name">{{ page.extra.author_byline }}</span>
            </div>
            {% endif %}
            
            {% if page.extra.year %}
            <div class="film-year">({{ page.extra.year }})</div>
            {% endif %}

            {% if page.extra.original_story and page.extra.story_author %}
            <div class="film-description">
                <p><em>Adapted from</em> {{ page.extra.original_story }} <em>by</em> {{ page.extra.story_author }}{% if page.extra.story_year %} ({{ page.extra.story_year }}){% endif %}</p>
            </div>
            {% endif %}

            <div class="section">
                <div class="content-body">
                    {{ page.content | safe }}
                </div>
            </div>

            <!-- Bibliography Section -->
            {% if page.extra.show_bibliography %}
            <div class="section bibliography">
                <h2 class="section-title">Bibliography</h2>
                <div class="section-content">
                    <p>The bibliography for this essay is included in the "<a href="{{ get_url(path='@/about/bibliography.md') }}">Film Adaptations Bibliography</a>" overview essay.</p>
                </div>
            </div>
            {% endif %}



            <!-- Citation Section -->
            {% if page.extra.show_citation %}
            <div class="section citation">
                <h2 class="section-title">Citation</h2>
                <div class="section-content">
                    <p class="citation-text">
                        {% if page.extra.author_byline %}{{ page.extra.author_byline }}. {% endif %}"{{ page.title }}." In {{ config.title }}. {{ config.base_url }}{{ page.permalink }}
                    </p>
                    <div class="citation-url">&lt;{{ config.base_url }}{{ page.permalink }}&gt;</div>
                </div>
            </div>
            {% endif %}

            <!-- Taxonomy links -->
            {% if page.taxonomies %}
            <div class="section">
                <div class="section-title">Related</div>
                <div class="taxonomies">
                    {% if page.taxonomies.authors %}
                    <div class="taxonomy-group">
                        <h4>Authors</h4>
                        {% for author in page.taxonomies.authors %}
                        <a href="{{ get_taxonomy_url(kind='authors', name=author) }}" class="tag">{{ author }}</a>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if page.taxonomies.regions %}
                    <div class="taxonomy-group">
                        <h4>Regions</h4>
                        {% for region in page.taxonomies.regions %}
                        <a href="{{ get_taxonomy_url(kind='regions', name=region) }}" class="tag">{{ region }}</a>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if page.taxonomies.decades %}
                    <div class="taxonomy-group">
                        <h4>Era</h4>
                        {% for decade in page.taxonomies.decades %}
                        <a href="{{ get_taxonomy_url(kind='decades', name=decade) }}" class="tag">{{ decade }}</a>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Enhanced sidebar with action links and metadata -->
        <aside class="film-sidebar">
            <!-- Action links like WFP -->
            <div class="action-links">
                {% if page.extra.show_bibliography %}<a href="#bibliography">Bibliography</a>{% endif %}
                {% if page.extra.show_citation %}<a href="#citation" class="citation">Citation</a>{% endif %}
                <a href="javascript:window.print()" class="print">Print</a>
            </div>

            <!-- Film image if available -->
            {% if page.extra.film_image %}
            <div class="film-image-container">
                <img src="{{ page.extra.film_image.url }}" alt="{{ page.extra.film_image.alt | default(value=page.title) }}">
                {% if page.extra.film_image.caption %}
                <div class="image-caption">{{ page.extra.film_image.caption }}</div>
                {% endif %}
            </div>
            {% endif %}

            {% if page.extra %}
            <div class="metadata-box">
                <h3>Film Details</h3>
                
                {% if page.extra.year %}
                <div class="metadata-item">
                    <span class="label">Year</span>
                    <div class="value">{{ page.extra.year }}</div>
                </div>
                {% endif %}
                
                {% if page.extra.director %}
                <div class="metadata-item">
                    <span class="label">Director</span>
                    <div class="value">{{ page.extra.director }}</div>
                </div>
                {% endif %}
                
                {% if page.extra.studio %}
                <div class="metadata-item">
                    <span class="label">Studio</span>
                    <div class="value">{{ page.extra.studio }}</div>
                </div>
                {% endif %}
                
                {% if page.extra.stars %}
                <div class="metadata-item">
                    <span class="label">Stars</span>
                    <div class="value">
                        {% for star in page.extra.stars %}
                            {{ star }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                {% if page.extra.survival_status %}
                <div class="metadata-item">
                    <span class="label">Availability</span>
                    <div class="value">
                        <span class="status {{ page.extra.survival_status | lower }}">
                            {{ page.extra.survival_status }}
                        </span>
                    </div>
                </div>
                {% endif %}
                
                {% if page.extra.setting %}
                <div class="metadata-item">
                    <span class="label">Setting</span>
                    <div class="value">{{ page.extra.setting }}</div>
                </div>
                {% endif %}
                
                {% if page.extra.format %}
                <div class="metadata-item">
                    <span class="label">Format</span>
                    <div class="value">{{ page.extra.format }}</div>
                </div>
                {% endif %}
                
                {% if page.extra.duration %}
                <div class="metadata-item">
                    <span class="label">Duration</span>
                    <div class="value">{{ page.extra.duration }}</div>
                </div>
                {% endif %}
            </div>

            {% if page.extra.original_story %}
            <div class="metadata-box">
                <h3>Source Literature</h3>
                
                <div class="metadata-item">
                    <span class="label">Original Work</span>
                    <div class="value">{{ page.extra.original_story }}</div>
                </div>
                
                {% if page.extra.story_author %}
                <div class="metadata-item">
                    <span class="label">Author</span>
                    <div class="value">{{ page.extra.story_author }}</div>
                </div>
                {% endif %}
                
                {% if page.extra.story_year %}
                <div class="metadata-item">
                    <span class="label">Published</span>
                    <div class="value">{{ page.extra.story_year }}</div>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Production Details Box -->
            {% if page.extra.production_company or page.extra.distributor or page.extra.filming_locations %}
            <div class="metadata-box">
                <h3>Production</h3>
                
                {% if page.extra.production_company %}
                <div class="metadata-item">
                    <span class="label">Production Company</span>
                    <div class="value">{{ page.extra.production_company }}</div>
                </div>
                {% endif %}
                
                {% if page.extra.distributor %}
                <div class="metadata-item">
                    <span class="label">Distributor</span>
                    <div class="value">{{ page.extra.distributor }}</div>
                </div>
                {% endif %}
                
                {% if page.extra.filming_locations %}
                <div class="metadata-item">
                    <span class="label">Filmed</span>
                    <div class="value">
                        {% for location in page.extra.filming_locations %}
                            {{ location }}{% if not loop.last %}<br>{% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            {% endif %}
            {% endif %}
        </aside>
    </div>
</article>
{% endblock content %}